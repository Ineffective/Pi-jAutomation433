"use strict";angular.module("pi4jfrontend",["ionic","ngRoute","ngAnimate","ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/edit",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("pi4jfrontend").controller("MainCtrl",["$scope","backendService","localStorageService",function(a,b,c){a.init=function(){a.plugs=c.getAllPlugs(),b.fetchPlugsAndUpdateLocalStorage()},a.setPlugState=function(c,d){var e;d&&(e=b.plugOn(c)),d||(e=b.plugOff(c)),e.success(function(b){a.updateLocalPlugStateById(b.id,b.lastKnownState)})},a.updateLocalPlugStateById=function(b,c){for(var d=0;d<a.plugs.length;d++)a.plugs[d].id==b&&(a.plugs[d].lastKnownState=c)},a.init()}]),angular.module("pi4jfrontend").controller("EditCtrl",["$scope","backendService","localStorageService",function(a,b,c){a.submitPlug=function(a){b.submitPlug(a)},a.deletePlug=function(a){b.deletePlug(a)},a.init=function(){a.plugs=c.getAllPlugs()},a.init()}]),angular.module("pi4jfrontend").controller("SettingsCtrl",["$scope","backendService",function(a,b){a.ip="",a.setNewIP=function(){b.setIP(a.ip)},a.init=function(){a.ip=b.getIP()},a.init()}]),angular.module("pi4jfrontend").factory("localStorageService",function(){var a=JSON.parse(localStorage.getItem("allPlugs"));null==a&&(a=[]);var b=function(b){a?a.splice(0,a.length):a=[];for(var c=0;c<b.length;c++)a.push(b[c]);f()},c=function(b){var c=e(b);a.splice(c,1),f()},d=function(b){var c=e(b);c>=0&&(a[c]=b,f())},e=function(b){if(a)for(var c=0;c<a.length;c++)if(a[c].id==b.id)return c},f=function(){localStorage.setItem("allPlugs",JSON.stringify(a))},g=function(){return a};return{updatePlugsInLocalStorage:b,getAllPlugs:g,removePlugFromLocalStorage:c,updateSpecificPlugInLocalStorage:d}}),angular.module("pi4jfrontend").factory("backendService",["$http","$resource","localStorageService",function(a,b,c){var d=localStorage.getItem("backendIP"),e=":8080/IoT_Spring_BPM/service/switch",f=function(){return"http://"+d+e},g=function(){var a=b(f()+"/getAllPlugsAvailable"),d=a.query();d.$promise.then(function(a){c.updatePlugsInLocalStorage(a)})},h=function(b){var d=a({method:"PUT",url:f()+"/deactivate",data:b,headers:{"Content-Type":"application/json"}});return d.then(function(a){c.updateSpecificPlugInLocalStorage(a.data)}),d},i=function(b){var d=a({method:"PUT",url:f()+"/activate",data:b,headers:{"Content-Type":"application/json"}});return d.then(function(a){c.updateSpecificPlugInLocalStorage(a.data)}),d},j=function(b){return a({method:"POST",url:f()+"/addplug",data:b}).then(function(a){return a.data})},k=function(b){return a({method:"DELETE",url:f()+"/deleteplug/"+b.id}).then(function(a){200==a.status&&c.removePlugFromLocalStorage(b)})},l=function(a){d=a,localStorage.setItem("backendIP",a)},m=function(){return d};return{fetchPlugsAndUpdateLocalStorage:g,submitPlug:j,plugOff:h,plugOn:i,setIP:l,getIP:m,deletePlug:k}}]);